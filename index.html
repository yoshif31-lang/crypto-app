<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto App Test</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body style="background-color: #0b0e11; color: white; padding: 15px; font-family: sans-serif;">
    <h2 style="color: #f0b90b;">接続診断モード</h2>
    <div id="price" style="font-size: 24px; margin-bottom: 10px;">価格: 読み込み中...</div>
    <div id="chartContainer" style="width: 100%; height: 300px; border: 1px solid #444;"></div>
    <div id="log" style="margin-top: 20px; font-size: 12px; color: #ffaa00; background: #222; padding: 10px; border-radius: 5px;">
        ログ: 準備中...
    </div>

    <script>
        const log = (msg) => { document.getElementById('log').innerText += "\n> " + msg; };
        
        async function startApp() {
            log("プログラム開始");
            try {
                const url = "https://api.bybit.com/v5/market/kline?category=linear&symbol=BTCUSDT&interval=1&limit=50";
                log("データ取得開始...");
                
                const res = await fetch(url);
                if (!res.ok) throw new Error("通信失敗 (Status: " + res.status + ")");
                
                const json = await res.json();
                log("データ受信成功！");
                
                const container = document.getElementById('chartContainer');
                const chart = LightweightCharts.createChart(container, {
                    layout: { backgroundColor: '#0b0e11', textColor: '#d1d4dc' },
                    timeScale: { timeVisible: true }
                });
                const candleSeries = chart.addCandlestickSeries();
                
                const data = json.result.list.map(d => ({
                    time: parseInt(d[0]) / 1000,
                    open: parseFloat(d[1]), high: parseFloat(d[2]),
                    low: parseFloat(d[3]), close: parseFloat(d[4])
                })).reverse();
                
                candleSeries.setData(data);
                document.getElementById('price').innerText = "BTC: $" + data[data.length-1].close;
                log("チャート表示完了！");
                
            } catch (e) {
                log("エラー発生: " + e.message);
                log("ヒント: ブラウザの翻訳機能をオフにして試してください");
            }
        }
        startApp();
    </script>
</body>
</html>
